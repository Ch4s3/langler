<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content={get_csrf_token()} />
    <.live_title default="NewsDeck" suffix=" Â· Phoenix Framework">
      {assigns[:page_title]}
    </.live_title>
    <%!-- Preload critical resources for faster FCP --%>
    <link phx-track-static rel="preload" href={~p"/assets/css/app.css"} as="style" />
    <link
      phx-track-static
      rel="preload"
      href={~p"/images/logo.svg"}
      as="image"
      fetchpriority="high"
    />
    <%!-- Critical CSS: ultra-minimal styles for layout only --%>
    <style>
      /* Structural-only critical CSS - colors come from theme variables */
      html{font-family:system-ui,-apple-system,sans-serif;line-height:1.5}
      body{margin:0;min-height:100vh}
      .primary-nav{position:sticky;top:0;z-index:50;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}
      .primary-nav>div{max-width:72rem;margin:0 auto;display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:1rem;padding:1rem}
      .primary-nav a{text-decoration:none;display:flex;align-items:center;gap:.75rem;font-size:1.125rem;font-weight:600}
      .primary-nav img{width:36px;height:36px;flex-shrink:0;display:block}
    </style>
    <%!-- Load full CSS asynchronously to avoid render blocking --%>
    <link
      phx-track-static
      rel="stylesheet"
      href={~p"/assets/css/app.css"}
      media="print"
      onload="this.media='all';this.onload=null"
    />
    <noscript>
      <link phx-track-static rel="stylesheet" href={~p"/assets/css/app.css"} />
    </noscript>
    <%!-- Theme switcher for DaisyUI data-theme attribute --%>
    <script>
      // Apply saved theme on load
      const theme = localStorage.getItem('theme') || 'sage';
      document.documentElement.setAttribute('data-theme', theme);

      // Listen for theme change events
      window.addEventListener('phx:set-theme', (e) => {
        const newTheme = e.target?.dataset?.theme;
        if (newTheme) {
          const html = document.documentElement;
          
          // Remove old theme attribute
          html.removeAttribute('data-theme');
          
          // Force reflow
          void html.offsetHeight;
          
          // Set new theme
          html.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
          
          // Verify CSS variables updated
          const styles = getComputedStyle(html);
          console.log('[Theme] Applied:', newTheme);
          console.log('[Theme] base-100:', styles.getPropertyValue('--color-base-100').trim());
          console.log('[Theme] base-content:', styles.getPropertyValue('--color-base-content').trim());
        }
      });
    </script>
    <script defer phx-track-static type="module" src={~p"/assets/js/app.js"}>
    </script>
  </head>
  <body class="min-h-screen bg-base-200 text-base-content overflow-x-hidden">
    {@inner_content}
  </body>
</html>
